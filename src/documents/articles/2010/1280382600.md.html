---
layout: 'article'
title: '와우 war overlay'
author: 'Changwoo Park'
date: '2010-07-29'
tags: ["Java","Spring","Grails"]
---

<h2>War overlay</h2>

<p>maven-war-plugin에서 war overlay기능이라는 것을 발견했습니다. 기존에는 웹 어플리케이션을 각 모듈별로 프로젝트를 나눌 수가 없었습니다. 솔루션 SI프로젝트에서 war overlay가 유용한 경우는 많습니다. 제가 생각하는 이점은 다음과 같습니다.</p>

<ul><li>jsp등의 web resource들의 버전관리&#160;: 동일한 코드인데도 불구하고 web resource들을 각 사이트마다 관리해야 하는 문제가 종종 있습니다. 이 것은 매우 고달프고 어느순간 달라지기 시작하여 팀 전체의 에너지를 갉아먹기 시작합니다. java 코드는 모듈별로 굉장히 잘 관리할 방법을 제공하는데 web resource는 왜 제공하지 않는지 그동안 매우 불만스러웠습니다.</li>
<li>사이트마다의 설정관리&#160;: 일반적으로 프로젝트는 3개의 환경이 필요합니다. 하나는 운영환경(production), 개발환경(development), 테스트환경(test)이 필요합니다. java등의 일반적인 리소스의 경우 운영환경과 테스트환경은 maven에서 아주 잘 지원합니다. 개발환경도 maven profile과 filter를 이용하면 만족할 만큼 커버가 됩니다. 그러나 각 사이트마다 관리하기엔 많이 부족합니다. 사이트 개수*3의 설정을 관리해야 하니 프로젝트가 곧 너저분 해집니다. </li>
</ul><p>언제부터 지원했는지는 모르겠지만 war overlay라는 설정이 가능하다는 것을 발견했습니다. 이제 각 환경에 대한 설정도 관리하고 web resource의 중복도 최소화 할 수 있습니다. 이렇게 절약한 시간으로 퇴근합시다.^^;</p>

<p>자 이제 설정하는 법을 살펴봅시다.</p>

<h2>준비</h2>

<p>먼저 프로젝트 구조 부터 잡습니다. 저는 다음과 같이 나누었습니다.</p>

<p><img src="http://dogfeet-support.appspot.com/static/tistory/198.attachment.war_overlay.PNG" alt="" height="267" width="520"/></p>

<ul><li>parent 프로젝트는 공통적인 maven 설정을 관리하기 위해 만들었습니다. 만약 parent프로젝트없이 설정하고 싶으시면 mixin 컨셉을 지원하는 maven3를 시도해보시는 것도 괜찮아 보입니다.</li>
<li>base 프로젝트는 공통코드입니다. java, web resources들을 넣습니다.</li>
<li>site1, site2 프로젝트는 실제 사이트 코드입니다. 해당 사이트만 해당되는 코드들을 넣습니다.</li>
</ul><h2>Maven 설정</h2>

<p>parent</p>

<pre><code>&lt;wb-resource deploy-path="/WEB-INF/classes" source-path="/src/main/resources"/&gt;
&lt;wb-resource deploy-path="/WEB-INF/classes" source-path="linked/base.resources"/&gt;
&lt;wb-resource deploy-path="/" source-path="linked/base.webapp"/&gt;
&lt;wb-resource deploy-path="/" source-path="/src/main/webapp"/&gt;
</code></pre>