---
layout: 'article'
title: 'Dev Environment in Maven2'
author: 'Changwoo Park'
date: '2010-04-27'
tags: ["Java","Spring","Grails","dev environment","maven2","개발환경"]
---

<p>m2eclipse를 사용하게 되면서 maven에 흠뻑 빠져들고 있습니다만, 아직 TDD에 익숙하지 않은 상황에서 더군다나 다른 팀원이 전혀 TDD에 관심이 없는 상황에서 Dev 환경이 없는 것은 꽤 불편합니다. 저 혼자 TDD를 사용하는 데는 상상한 제약이 따릅니다. TDD에 따른다는 상황에서는 maven은 흠 잡을 때 없습니다만, Test없이 eclipse에서 debuging하려고 하면&#8222;&#8222;가슴이 답답해져 옵니다.</p>

<h2>Dev 환경의 필요성?</h2>

<p>Dev 환경은 필요한 이유는 전적으로 TDD를 따르지 않기 때문입니다. dev 환경이 필요하다라고 주장하는 것은 &#8216;야매 의사가 내손은 약손이다. 내손으로 암도 고칠 수 있다&#8217;라고 주장하는 것과 왠지 비슷해 보입니다.</p>

<p>그렇지만 TDD를 따르지 않는 다면 Dev환경이 너무 아쉽습니다. Grails에서 지원하던(rails에서도 되는지는 모르겠습니다.) Dev 환경이 너무 아쉽습니다. 개발 환경의 설정을 배포시 매번 수정하는 것도 꽤나 번거로운 작업인데다가 실수의 연속이고 있습니다.</p>

<h2>Maven Profile</h2>

<p>Maven은 Profile 개념을 가지고 있습니다. mvn실행시 다른 설정을 적용할 수 있게 해줍니다. 간단한 Profile을 설정은 다음과 같습니다. dev, prod를 profile로 만들어 봅니다:</p>

<pre><code>&lt;profiles&gt;
    &lt;profile&gt;
        &lt;id&gt;dev&lt;/id&gt;
        &lt;activation&gt;
            &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;
        &lt;/activation&gt;
    &lt;/profile&gt;
    &lt;profile&gt;
        &lt;id&gt;prod&lt;/id&gt;
    &lt;/profile&gt;
&lt;/profiles&gt; 
</code></pre>

<p>activeByDefault를 이용해서 profile을 선택하지 않는 다면 dev profile이 선택되도록 설정했습니다.</p>

<p>다음과 같이 profile을 선택하여 실행할 수 있습니다:</p>

<pre class="syntax-highlighter shell">mvn build -Pdev # dev profile로 실행합니다. -Pdev를 생략해도 dev profile로 실행합니다.
or
mvn build -Pprod # prod profile로 실행합니다.
</pre>

<h2>Maven directory layout</h2>

<p>이제 entry point는 만들었으니 dev를 위한 directory layout을 추가합니다.</p>

<p>다음과 같으 profile을 만듭니다:</p>

<pre><code>&lt;profiles&gt;
    &lt;profile&gt;
        &lt;id&gt;dev&lt;/id&gt;
        &lt;activation&gt;
            &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;
        &lt;/activation&gt;
        &lt;build&gt;
            &lt;plugins&gt;
                &lt;plugin&gt;
                    &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
                    &lt;artifactId&gt;build-helper-maven-plugin&lt;/artifactId&gt;
                    &lt;version&gt;1.5&lt;/version&gt;
                    &lt;executions&gt;
                        &lt;execution&gt;
                            &lt;id&gt;build-helper-add-source&lt;/id&gt;
                            &lt;phase&gt;generate-sources&lt;/phase&gt;
                            &lt;goals&gt;
                                &lt;goal&gt;add-source&lt;/goal&gt;
                            &lt;/goals&gt;
                            &lt;configuration&gt;
                                &lt;sources&gt;
                                    &lt;source&gt;${basedir}/src/dev/java&lt;/source&gt;
                                &lt;/sources&gt;
                            &lt;/configuration&gt;
                        &lt;/execution&gt;
                        &lt;execution&gt;
                            &lt;id&gt;build-helper-add-resource&lt;/id&gt;
                            &lt;phase&gt;generate-resources&lt;/phase&gt;
                            &lt;goals&gt;
                                &lt;goal&gt;add-resource&lt;/goal&gt;
                            &lt;/goals&gt;
                            &lt;configuration&gt;
                                &lt;resources&gt;
                                    &lt;resource&gt;&lt;directory&gt;${basedir}/src/dev/resources&lt;/directory&gt;&lt;/resource&gt;
                                &lt;/resources&gt;
                            &lt;/configuration&gt;
                        &lt;/execution&gt;
                    &lt;/executions&gt;
                &lt;/plugin&gt;
            &lt;/plugins&gt;
        &lt;/build&gt;
    &lt;/profile&gt;
    &lt;profile&gt;
        &lt;id&gt;prod&lt;/id&gt;
    &lt;/profile&gt;
&lt;/profiles&gt; 
</code></pre>

<p>prod profile에서는 maven default를 사용합니다. 하지만 <strong>dev profile에서는 soruce directory에 /src/main/java와 /src/dev/java를 사용하고 resource directory에 /src/main/resources와 /src/dev/resources를</strong> 사용합니다.</p>

<p>build-helper-maven-plugin를 이용해서 Maven Directory Layout에 간단히 directory를 추가할 수 있습니다. 기존의(Maven의) 것을 변경하려면 build/sourceDirctory나 build/resources를 사용해야 합니다.</p>

<p>이제 자신만의 Convention을 만들어서 사용하시면 됩니다. dev profile에서 어떤 layout이 편리할지는 지금 고민하고 있습니다. 아직 어떤게 가장 좋은 패턴인지는 확신이 서질 않습니다.</p>

<h2>결론</h2>

<p>지금 추가한 dev, prod는 maven의 main, test와 수평적인 관계가 아닙니다. main과 test는 maven에서 제공하는 아주 복잡한(저는 복잡하다고 생각합니다.) phase와 goal들과 연관이 있습니다. 지금 이것을 설명하기에는 제가 공부를 더해야 해서 대충 넘어갑니다.</p>

<p>이제 다음과 같은 조합이 가능합니다:</p>

<ul><li><strong>dev + main - service mocking, dev db등의 설정을 main의 설정과 별도로 유지할 수 있습니다.</strong></li>
<li>dev + test -  /src/dev에 있는 source와 resource를 활용하여 테스트를 진행할 수 있습니다만, 별로 유용하지 않습니다.</li>
<li>prod + main - maven과 defualt와 완전 동일하므로 생략합니다.</li>
<li>prod + test - maven과 defualt와 완전 동일하므로 생략합니다.</li>
</ul><p>이번 글에서는 dev 환경에 대한 테크닉만을 소개하였습니다. 나중에, 사용해보고 경험이 축적되면 Convention에 관한 글도 올리도록 하겠습니다.</p>