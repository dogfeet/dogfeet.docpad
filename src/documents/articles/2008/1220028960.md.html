---
layout: 'article'
title: 'pistools.Piler'
author: 'Changwoo Park'
date: '2008-08-29'
tags: ["Groovy","pistools"]
---

<h3><a name="pistools.piler" id="pistools.piler">pistools.piler</a></h3>

<p>간단히 일상 생활에 필요한 스크립트를 만드는 것을 생활화하고자 하고 있습니다.뭐 진작에 습관을 들였어야 했는데 미루고
미루다가 이제아 만들어 봅니다. pismute라는 아이디는 지을 때부터 이름짓기 편하도록 만들었기 때문에 pistools라고
그냥 정해버렸습니다. 이 프로그램은 아주 간단한 프로그램으로 여친님의 사진 파일을 생성날짜 별로 정리하려고 만들었습니다.
flickr같은데 부어줘도 될 것 같긴하지만&#8222;,워낙 사진이 5년 동안 모은 고용량인데다가 아직 flickr를 사용해보진 않아서
좋은지 않좋은지 잘 모르겠네요.-_-;;;;</p>

<form class="button btn_secedit" method="post" action="/wiki/doku.php/workspace/pistools/piler"><input name="do" value="edit" type="hidden"><input name="lines" value="1-724" type="hidden"><input name="rev" value="1220185264" type="hidden"><a name="%EC%9A%94%EA%B5%AC%EC%82%AC%ED%95%AD" id="요구사항"><font size="3"><span style="font-weight: bold;">요구사항</span></font></a></form>

<p>지정된 모든 파일들을 수정 날자별로 폴더를 만들고 옮기거나 복사합니다. 예를 들면 다음과 같은 구조입니다. 깊이를 3개까지 가져갈 필요는 없다는 생각이 들었습니다. 보통 그래야 할만큼 사진을 많이찍지 않으니까요…</p>

<pre><code>&lt;blockquote&gt;2008--0829--08302009--0901&lt;/blockquote&gt; 
</code></pre>

<ul><li class="level1"> changed at 20080830
<ol><li class="level2"> 동일한 파일이름이 존재할 경우 앞에 $number_를 자동으로 붙여주도록 수정
</li><li class="level2"> ant.mkdir제거, ant.copy가 mkdir까지 해주네요.
</li><li class="level2"> 실제 copy, move없이 결과를 엿볼 수 있도록 test method 추가.
</li></ol></li></ul><form class="button btn_secedit" method="post" action="/wiki/doku.php/workspace/pistools/piler"><input name="do" value="edit" type="hidden"><input name="lines" value="725-1354" type="hidden"><input name="rev" value="1220185264" type="hidden"><font size="3"><a name="%EA%B5%AC%ED%98%84_%EC%9D%B4%EC%8A%88" id="구현_이슈">구현 이슈</a></font></form>

<h5><a name="groovy" id="groovy">Groovy</a></h5>

<p>Groovy로 구현했습니다. 요즘 Groovy에 공을 들이려고 노력하고 있습니다. ruby를 배워볼까하는 맘이
잠깐있었지만&#8222;,머리속에 있는 java api를 버리고 새로 익히자니 너무 힘들어서 포기했습니다. groovy 너무 좋아요.</p>

<h5><a name="%EC%83%9D%EC%84%B1_%EB%82%A0%EC%9E%90_%EB%AC%B8%EC%A0%9C" id="생성_날자_문제">생성 날자 문제</a></h5>

<p>*nix 시스템의 파일 시스템들은 생성날자정보를 저장하지 않는데다가 파일을 단순히 복사하기만해도 생성날자가 변경되므로
수정날자를 이용하는 것이 적합해 보입니다. 그리고 생성날자를 이용하려면 JNI를 이용해야하고 외국의 구현체들의 한글 문제까지하면
더 더욱 복잡해집니다. 그러니 수정날자를 이용하였습니다.</p>

<h5><a name="code" id="code">code</a></h5>

<p>역시 그루비 입니다. 코드가 상당히 단순해집니다. 하지만 java와 groovy 어느 것이 개발하기 편하냐고 물으신다면
아직은 java입니다. 저는 주로 eclipse를 사용하는데 groovy eclipse plugin은 아직도 걸음마 단계입니다.
할 때마다 경로잡고 하는 일이 너무 짜증나네요.</p>

<p>netbeans는 조금 써보고 버렸습니다. svn동작이 깔끔하지않아요(물론 ganymede에서도 svnkit connector가
아직 불안정하여 자꾸 암호를 물어보는 버그가 있긴 하지만&#8222;,) 6.5 정식 버전이나 7.0이 나오면 netbeans를 주요
개발 툴로 사용할 지도 모르겠습니다. 현재 사용해본 바로는 groovy &amp; grails plugin은 확실히
netbeans가 더 좋지만 툴 자체는 eclipse가 좋은 것 같아 고민입니다…</p>

<blockquote><span class="coMULTI">/** *  */</span><a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20package"><span class="kw2">package</span></a> pistools <span class="co2">import java.util.Calendar</span> <span class="coMULTI">/** * @author pismute * */</span><a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20public"><span class="kw2">public</span></a> <a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20class"><span class="kw2">class</span></a> Piler<span class="br0">{</span>   <a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20public"><span class="kw2">public</span></a> <a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20static"><span class="kw2">static</span></a> <a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20void"><span class="kw4">void</span></a> main<span class="br0">(</span><a href="http://www.google.de/search?as_q=String&amp;num=100&amp;hl=en&amp;as_occt=url&amp;as_sitesearch=java.sun.com%2Fj2se%2F1.5.0%2Fdocs%2Fapi%2F"><span class="kw3">String</span></a><span class="br0">[</span><span class="br0">]</span> args<span class="br0">)</span> <span class="br0">{</span>      <a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20def"><span class="kw2">def</span></a> piler <span class="sy0">=</span> <a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20new"><span class="kw2">new</span></a> Piler<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>      <a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20if"><span class="kw1">if</span></a><span class="br0">(</span> args.<span class="me1">length</span> <span class="sy0">!=</span> <span class="nu0">3</span><span class="br0">)</span> <span class="br0">{</span>           piler.<span class="me1">usage</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>      <span class="br0">}</span>      <a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20if"><span class="kw1">if</span></a><span class="br0">(</span> <span class="sy0">!</span>args<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">equals</span><span class="br0">(</span><span class="st0">&#8220;copy&#8221;</span><span class="br0">)</span> <span class="sy0">&amp;&amp;</span>                    <span class="sy0">!</span>args<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">equals</span><span class="br0">(</span><span class="st0">&#8220;move&#8221;</span><span class="br0">)</span> <span class="sy0">&amp;&amp;</span>                    <span class="sy0">!</span>args<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">equals</span><span class="br0">(</span><span class="st0">&#8220;test&#8221;</span><span class="br0">)</span> <span class="br0">)</span> <span class="br0">{</span>            piler.<span class="me1">usage</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>      <span class="br0">}</span>      piler.<span class="me1">pile</span><span class="br0">(</span>args<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>, args<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>, args<span class="br0">[</span><span class="nu0">2</span><span class="br0">]</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>  <a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20def"><span class="kw2">def</span></a> usage<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>       <a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20println"><span class="kw8">println</span></a> <span class="st0">&#8220;piler [test | copy | move] [src] [dest]&#8221;</span>     <a href="http://www.google.de/search?as_q=System&amp;num=100&amp;hl=en&amp;as_occt=url&amp;as_sitesearch=java.sun.com%2Fj2se%2F1.5.0%2Fdocs%2Fapi%2F"><span class="kw3">System</span></a>.<span class="me1">exit</span><span class="br0">(</span><span class="nu0">0</span><span class="br0">)</span>   <span class="br0">}</span>  <a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20def"><span class="kw2">def</span></a> pile<span class="br0">(</span><a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20def"><span class="kw2">def</span></a> method, <a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20def"><span class="kw2">def</span></a> src, <a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20def"><span class="kw2">def</span></a> dest<span class="br0">)</span> <span class="br0">{</span>        AntBuilder ant <span class="sy0">=</span> <a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20new"><span class="kw2">new</span></a> AntBuilder<span class="br0">(</span><span class="br0">)</span>       <a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20def"><span class="kw2">def</span></a> files <span class="sy0">=</span> ant.<span class="me1">fileScanner</span><span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>           fileset<span class="br0">(</span>dir:src<span class="br0">)</span> <span class="br0">{</span>               include<span class="br0">(</span>name:<span class="st0">&#8221;**/*&#8221;</span><span class="br0">)</span>             exclude<span class="br0">(</span>name:<span class="st0">&#8221;**/*Thumbs.db&#8221;</span><span class="br0">)</span>                exclude<span class="br0">(</span>name:<span class="st0">&#8221;**/*.ai&#8221;</span><span class="br0">)</span>          <span class="br0">}</span>      <span class="br0">}</span>      <a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20def"><span class="kw2">def</span></a> total <span class="sy0">=</span> <span class="nu0">0</span>        <a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20def"><span class="kw2">def</span></a> changed <span class="sy0">=</span> <span class="nu0">0</span>      <a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20def"><span class="kw2">def</span></a> mapper <span class="sy0">=</span> <span class="br0">[</span>:<span class="br0">]</span>        files.<a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20each"><span class="kw5">each</span></a><span class="br0">{</span>          <a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20def"><span class="kw2">def</span></a> date <span class="sy0">=</span> <a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20new"><span class="kw2">new</span></a> <a href="http://www.google.de/search?as_q=Date&amp;num=100&amp;hl=en&amp;as_occt=url&amp;as_sitesearch=java.sun.com%2Fj2se%2F1.5.0%2Fdocs%2Fapi%2F"><span class="kw3">Date</span></a><span class="br0">(</span> it.<span class="me1">lastModified</span><span class="br0">(</span><span class="br0">)</span> <span class="br0">)</span>           <a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20def"><span class="kw2">def</span></a> cal <span class="sy0">=</span> <a href="http://www.google.de/search?as_q=Calendar&amp;num=100&amp;hl=en&amp;as_occt=url&amp;as_sitesearch=java.sun.com%2Fj2se%2F1.5.0%2Fdocs%2Fapi%2F"><span class="kw3">Calendar</span></a>.<span class="me1">getInstance</span><span class="br0">(</span><span class="br0">)</span>          cal.<span class="me1">setTime</span><span class="br0">(</span>date<span class="br0">)</span>            <a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20def"><span class="kw2">def</span></a> year <span class="sy0">=</span>  cal.<a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20get"><span class="kw5">get</span></a><span class="br0">(</span><a href="http://www.google.de/search?as_q=Calendar&amp;num=100&amp;hl=en&amp;as_occt=url&amp;as_sitesearch=java.sun.com%2Fj2se%2F1.5.0%2Fdocs%2Fapi%2F"><span class="kw3">Calendar</span></a>.<span class="me1">YEAR</span><span class="br0">)</span>           <a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20def"><span class="kw2">def</span></a> monthAndDay <span class="sy0">=</span> <a href="http://www.google.de/search?as_q=String&amp;num=100&amp;hl=en&amp;as_occt=url&amp;as_sitesearch=java.sun.com%2Fj2se%2F1.5.0%2Fdocs%2Fapi%2F"><span class="kw3">String</span></a>.<span class="me1">format</span><span class="br0">(</span><span class="st0">&#8220;%02d%02d&#8221;</span>,                            cal.<a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20get"><span class="kw5">get</span></a><span class="br0">(</span><a href="http://www.google.de/search?as_q=Calendar&amp;num=100&amp;hl=en&amp;as_occt=url&amp;as_sitesearch=java.sun.com%2Fj2se%2F1.5.0%2Fdocs%2Fapi%2F"><span class="kw3">Calendar</span></a>.<span class="me1">MONTH</span><span class="br0">)</span> + <span class="nu0">1</span>,                            cal.<a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20get"><span class="kw5">get</span></a><span class="br0">(</span><a href="http://www.google.de/search?as_q=Calendar&amp;num=100&amp;hl=en&amp;as_occt=url&amp;as_sitesearch=java.sun.com%2Fj2se%2F1.5.0%2Fdocs%2Fapi%2F"><span class="kw3">Calendar</span></a>.<span class="me1">DAY_OF_MONTH</span><span class="br0">)</span><span class="br0">)</span>          <a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20int"><span class="kw4">int</span></a> i <span class="sy0">=</span> <span class="nu0">0</span>            <a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20def"><span class="kw2">def</span></a> name <span class="sy0">=</span> <span class="st0">&#8220;$dest/$year/$monthAndDay/${it.name}&#8221;</span>         <a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20boolean"><span class="kw4">boolean</span></a> duplicated <span class="sy0">=</span> <a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20false"><span class="kw2">false</span></a>         <a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20while"><span class="kw1">while</span></a><span class="br0">(</span>mapper<span class="br0">[</span>name<span class="br0">]</span> <span class="sy0">!=</span> <a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20null"><span class="kw2">null</span></a> <span class="br0">)</span> <span class="br0">{</span>               name <span class="sy0">=</span> <span class="st0">&#8220;$dest/$year/$monthAndDay/${i}_${it.name}&#8221;</span>             i++                 duplicated <span class="sy0">=</span> <a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20true"><span class="kw2">true</span></a>                <a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20println"><span class="kw8">println</span></a> <span class="st0">&#8221;${it.toString()}, $name&#8221;</span>         <span class="br0">}</span>          mapper<span class="br0">[</span>name<span class="br0">]</span> <span class="sy0">=</span> it.<span class="me1">toString</span><span class="br0">(</span><span class="br0">)</span>          <a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20if"><span class="kw1">if</span></a><span class="br0">(</span>duplicated<span class="br0">)</span> <span class="br0">{</span>             changed++<span class="sy0">;</span>         <span class="br0">}</span>          total++<span class="sy0">;</span>       <span class="br0">}</span>      mapper.<a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20each"><span class="kw5">each</span></a><span class="br0">{</span> key, value -<span class="sy0">&gt;</span>          <a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20if"><span class="kw1">if</span></a><span class="br0">(</span> <span class="sy0">!</span>method.<span class="me1">equals</span><span class="br0">(</span><span class="st0">&#8220;test&#8221;</span><span class="br0">)</span> <span class="br0">)</span> <span class="br0">{</span>              ant.<span class="st0">&#8220;$method&#8221;</span><span class="br0">(</span>file:value,                                   tofile: key,                                   preservelastmodified: <a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20true"><span class="kw2">true</span></a><span class="br0">)</span>         <span class="br0">}</span><a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20else"><span class="kw1">else</span></a><span class="br0">{</span>              <a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20println"><span class="kw8">println</span></a> <span class="st0">&#8220;$key, $value&#8221;</span>            <span class="br0">}</span>      <span class="br0">}</span>      <a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20println"><span class="kw8">println</span></a> <span class="st0">&#8220;$method $total files of $src to $dest!!&#8221;</span>     <a href="http://www.google.de/search?q=site%3Adocs.codehaus.org/%20println"><span class="kw8">println</span></a> <span class="st0">&#8220;the name of $changed files in $dest was changed!!&#8221;</span>   <span class="br0">}</span><span class="br0">}</span></blockquote>

<h5><a name="usage" id="usage">Usage</a></h5>

<p>사용법은 다음과 같습니다.</p>

<pre><code>&lt;blockquote&gt;groovy pistools.Piler [test|copy|move] [src] [dst]&lt;/blockquote&gt;
</code></pre>